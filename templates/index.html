<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Market Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .ticker-container {
      overflow: hidden;
      background-color: black;
    }
    .ticker {
      display: inline-block;
      white-space: nowrap;
      animation: scroll-left 40s linear infinite;
    }
    @keyframes scroll-left {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
  </style>
</head>
<body class="bg-white text-black">
  <div class="w-full py-4 text-center text-3xl font-bold">Stock Market</div>
  <div class="ticker-container py-2">
    <div id="ticker" class="ticker text-white text-sm font-mono"></div>
  </div>

  <div class="max-w-xl mx-auto px-4 mt-8">
    <input id="symbolInput" type="text" placeholder="Enter stock, ETF, or mutual fund name/symbol" class="border p-2 w-full rounded mb-2">
    <button onclick="getStockData()" class="bg-blue-600 text-white px-4 py-2 rounded w-full">Get Data</button>

    <div id="stockInfo" class="mt-6 hidden">
      <h2 class="text-xl font-bold mb-2" id="stockName"></h2>
      <p><strong>Symbol:</strong> <span id="stockSymbol"></span></p>
      <p><strong>Current Price:</strong> $<span id="stockPrice"></span></p>
      <p><strong>Day High:</strong> $<span id="dayHigh"></span></p>
      <p><strong>Day Low:</strong> $<span id="dayLow"></span></p>
      <p><strong>52 Week High:</strong> $<span id="high52"></span></p>
      <p><strong>52 Week Low:</strong> $<span id="low52"></span></p>
      <p><strong>Change:</strong> <span id="priceChange"></span> (<span id="percentChange"></span>)</p>
    </div>
  </div>

  <script>
    async function fetchTrending() {
      const res = await fetch('/trending');
      const data = await res.json();
      const tickerDiv = document.getElementById('ticker');
      tickerDiv.innerHTML = data.map(item => `<span class="mx-4">${item.symbol}: $${item.price.toFixed(2)}</span>`).join('');
    }

    async function getStockData() {
      const input = document.getElementById('symbolInput').value.trim();
      if (!input) return;

      const res = await fetch('/stock-data', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ symbol: input })
      });

      const data = await res.json();
      if (data.error) {
        alert(data.error);
        return;
      }

      document.getElementById('stockInfo').classList.remove('hidden');
      document.getElementById('stockName').textContent = data.name;
      document.getElementById('stockSymbol').textContent = data.symbol;
      document.getElementById('stockPrice').textContent = parseFloat(data.current_price).toFixed(2);
      document.getElementById('dayHigh').textContent = parseFloat(data.day_high).toFixed(2);
      document.getElementById('dayLow').textContent = parseFloat(data.day_low).toFixed(2);
      document.getElementById('high52').textContent = parseFloat(data.high_52week).toFixed(2);
      document.getElementById('low52').textContent = parseFloat(data.low_52week).toFixed(2);

      const abs = parseFloat(data.absolute_change).toFixed(2);
      const perc = parseFloat(data.percent_change).toFixed(2);

      const color = abs >= 0 ? 'text-green-600' : 'text-red-600';
      document.getElementById('priceChange').textContent = (abs >= 0 ? '+' : '') + abs;
      document.getElementById('priceChange').className = color;
      document.getElementById('percentChange').textContent = (perc >= 0 ? '+' : '') + perc + '%';
      document.getElementById('percentChange').className = color;
      document.getElementById('stockPrice').className = color;
    }

    fetchTrending();
  </script>
</body>
</html>

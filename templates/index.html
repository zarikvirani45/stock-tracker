<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stock Tracker</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #121212;
      color: white;
    }

    .container {
      margin-top: 50px;
    }

    .stock-info, .chart-container {
      margin-top: 30px;
    }

    .positive {
      color: #4caf50;
    }

    .negative {
      color: #f44336;
    }

    #news-section {
      margin-top: 50px;
    }

    #news-section h3 {
      border-bottom: 1px solid white;
      padding-bottom: 10px;
    }

    .news-article {
      background-color: #1e1e1e;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 5px;
    }

    .news-article h5 {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container text-center">
    <h1 class="mb-4">Stock Tracker</h1>
    <div class="mb-4">
      <input type="text" id="symbolInput" class="form-control" placeholder="Enter stock symbol (e.g. AAPL)" />
      <select id="timeframeSelect" class="form-select mt-2">
        <option value="1d">1 Day</option>
        <option value="1wk">1 Week</option>
        <option value="1mo" selected>1 Month</option>
        <option value="3mo">3 Months</option>
        <option value="6mo">6 Months</option>
        <option value="1y">1 Year</option>
        <option value="3y">3 Years</option>
        <option value="5y">5 Years</option>
        <option value="max">Max</option>
      </select>
      <button class="btn btn-primary mt-2" onclick="fetchStockData()">Get Stock Data</button>
    </div>

    <div class="stock-info" id="stockInfo" style="display: none;">
      <h2 id="stockName"></h2>
      <p>Current Price: <span id="currentPrice"></span></p>
      <p>Day High: <span id="dayHigh"></span> | Day Low: <span id="dayLow"></span></p>
      <p>52 Week High: <span id="high52Week"></span> | 52 Week Low: <span id="low52Week"></span></p>
      <p>Change: <span id="priceChange"></span> (<span id="percentChange"></span>%)</p>
    </div>

    <div class="chart-container" style="margin-top: 30px;">
      <canvas id="stockChart"></canvas>
    </div>

    <div id="news-section">
      <h3>Latest News</h3>
      <div class="news-article">
        <h5>Market opens higher on tech gains</h5>
        <p>The stock market saw early gains today, led by advances in technology stocks.</p>
      </div>
      <div class="news-article">
        <h5>Federal Reserve signals interest rate pause</h5>
        <p>In a recent statement, the Fed hinted at a potential pause on interest rate hikes amid inflation cooling.</p>
      </div>
    </div>
  </div>

  <script>
    let chart;

    function fetchStockData() {
      const symbol = document.getElementById("symbolInput").value.trim();
      const timeframe = document.getElementById("timeframeSelect").value;

      if (!symbol) {
        alert("Please enter a stock symbol.");
        return;
      }

      fetch("/stock-data", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ symbol, timeframe })
      })
      .then(res => res.json())
      .then(data => {
        if (data.error) {
          alert(data.error);
          return;
        }

        document.getElementById("stockInfo").style.display = "block";
        document.getElementById("stockName").innerText = `${data.name} (${data.symbol})`;
        document.getElementById("currentPrice").innerText = `$${parseFloat(data.current_price).toFixed(2)}`;
        document.getElementById("dayHigh").innerText = `$${parseFloat(data.day_high).toFixed(2)}`;
        document.getElementById("dayLow").innerText = `$${parseFloat(data.day_low).toFixed(2)}`;
        document.getElementById("high52Week").innerText = `$${parseFloat(data.high_52week).toFixed(2)}`;
        document.getElementById("low52Week").innerText = `$${parseFloat(data.low_52week).toFixed(2)}`;

        const priceChange = parseFloat(data.absolute_change).toFixed(2);
        const percentChange = parseFloat(data.percent_change).toFixed(2);
        const changeClass = priceChange >= 0 ? "positive" : "negative";

        document.getElementById("priceChange").innerText = priceChange;
        document.getElementById("percentChange").innerText = percentChange;
        document.getElementById("priceChange").className = changeClass;
        document.getElementById("percentChange").className = changeClass;

        // Chart
        if (chart) chart.destroy();

        const ctx = document.getElementById("stockChart").getContext("2d");
        chart = new Chart(ctx, {
          type: "line",
          data: {
            labels: data.chart.dates,
            datasets: [{
              label: "Price",
              data: data.chart.prices,
              borderColor: "#4caf50",
              backgroundColor: "rgba(76, 175, 80, 0.1)",
              fill: true,
              tension: 0.1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                labels: { color: "white" }
              }
            },
            scales: {
              x: {
                ticks: { color: "white" }
              },
              y: {
                ticks: { color: "white" }
              }
            }
          }
        });
      })
      .catch(err => {
        console.error("Fetch error:", err);
        alert("An error occurred while fetching stock data.");
      });
    }
  </script>
</body>
</html>
